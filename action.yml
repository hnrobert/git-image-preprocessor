name: "Git Image Preprocessor"
description: "Automatically compress and optimize images in commits and pull requests"
author: "hnrobert"

branding:
  icon: "image"
  color: "blue"

inputs:
  quality:
    description: "Compression quality for JPEG/WebP (1-100, default: 85)"
    required: false
    default: "85"

  max-width:
    description: "Maximum width in pixels (0 = no limit, default: 0)"
    required: false
    default: "0"

  max-height:
    description: "Maximum height in pixels (0 = no limit, default: 0)"
    required: false
    default: "0"

  convert-to:
    description: "Target format to convert to when set (jpg/png/webp). If empty, conversion is disabled."
    required: false
    default: ""

  git-user-name:
    description: "Git user name for commits (default: github-actions[bot])"
    required: false
    default: "github-actions[bot]"

  git-user-email:
    description: "Git user email for commits (default: github-actions[bot]@users.noreply.github.com)"
    required: false
    default: "github-actions[bot]@users.noreply.github.com"

  commit-message:
    description: 'Commit message for optimized images (default: "üñºÔ∏è Optimize images")'
    required: false
    default: "üñºÔ∏è Optimize images"

  file-patterns:
    description: 'File patterns to process (default: "*.jpg *.jpeg *.png *.webp")'
    required: false
    default: "*.jpg *.jpeg *.png *.webp *.heic *.heif *.avif *.tiff *.bmp *.gif"

  skip-ci:
    description: "Add [skip ci] to commit message (true/false, default: false)"
    required: false
    default: "false"

  remove-exif:
    description: "Remove EXIF metadata from images (true/false, default: true)"
    required: false
    default: "true"

  max-size-kb:
    description: "Target maximum size for converted image in KB (default 0 disables)"
    required: false
    default: "0"

  scan-whole-repo:
    description: "Scan entire repository (true) or only changed files in PR (false, default: false)"
    required: false
    default: "false"

outputs:
  optimized-count:
    description: "Number of images optimized"

  total-saved:
    description: "Total bytes saved"

  files-changed:
    description: "List of changed files"

runs:
  using: "docker"
  image: "docker://ghcr.io/hnrobert/git-image-preprocessor:v0.1.6"
  args:
    - ${{ inputs.quality }}
    - ${{ inputs.max-width }}
    - ${{ inputs.max-height }}
    - ${{ inputs.git-user-name }}
    - ${{ inputs.git-user-email }}
    - ${{ inputs.commit-message }}
    - ${{ inputs.file-patterns }}
    - ${{ inputs.skip-ci }}
    - ${{ inputs.remove-exif }}
    - ${{ inputs.convert-to }}
    - ${{ inputs.max-size-kb }}
    - ${{ inputs.scan-whole-repo }}
